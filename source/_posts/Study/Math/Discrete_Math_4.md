---
title: 离散数学（4）：组合数学
categories:
  - Study
  - Math
comments: true
description: 离散数学第四部分：组合数学
series: 离散数学笔记
hide: true
mathjax: false
katex: true
highlight_shrink: true
cover: /img/posts/离散数学.avif
abbrlink: 252acb63
date: 2025-11-29 00:00:00
updated: 2025-11-29 00:00:00
keywords:
top_img:
aside:
aplayer:
---

## 第12章 基本的组合计数公式

### 12.1 加法法则与乘法法则

这是组合计数中最基本的两个原则。

#### 1. 加法法则 (Addition Principle)
*   **适用场景**：分类计数（"或"的情况）。
*   **定义**：设事件 $A$ 有 $m$ 种产生方式，事件 $B$ 有 $n$ 种产生方式。如果 $A$ 与 $B$ 的产生方式**不重叠**（互斥），那么“事件 $A$ **或** $B$”共有 $m+n$ 种产生方式。
*   **集合语言**：若 $A \cap B = \varnothing$，则 $|A \cup B| = |A| + |B|$。
*   **推广**：若 $n$ 个事件 $A_1, A_2, \dots, A_n$ 两两互斥，且分别有 $p_1, p_2, \dots, p_n$ 种方式，则从中任选一个事件发生共有 $p_1 + p_2 + \dots + p_n$ 种方式。

#### 2. 乘法法则 (Multiplication Principle)
*   **适用场景**：分步计数（"且"的情况）。
*   **定义**：设事件 $A$ 有 $m$ 种产生方式，事件 $B$ 有 $n$ 种产生方式。如果 $A$ 与 $B$ 的产生方式**彼此独立**（互不影响），那么“事件 $A$ **与** $B$”共有 $m \times n$ 种产生方式。
*   **集合语言**：$|A \times B| = |A| \cdot |B|$。
*   **推广**：若一个过程分为 $n$ 个步骤，第 $i$ 步有 $p_i$ 种选择，且每一步的选择都独立于之前的选择，则完成整个过程共有 $p_1 \times p_2 \times \dots \times p_n$ 种方式。

### 12.2 排列与组合

排列和组合的计数是基本的计数问题。其核心在于两个维度：
1.  **有序 vs 无序**：选出来的元素是否讲究顺序？
2.  **不重复 vs 可重复**：同一个元素是否可以被多次选取？

#### 1. 集合的排列 (Permutation of Sets) —— 无重复，有序

这是最经典的模型：从一堆**不同**的东西里，选出几个来**排队**。

*   **排列**：
    设 $S$ 为 $n$ 元集（包含 $n$ 个不同元素的集合）。
    *   **$r$ 排列**：从 $S$ 中**有序**选取的 $r$ 个元素称为 $S$ 的一个 $r$ 排列。
    *   **全排列**：当 $r=n$ 时，称为 $S$ 的全排列。
*   **记号**：
    $S$ 的不同 $r$ 排列总数记作 $P(n, r)$。
*   **排列数公式**：
    $$ P(n, r) = n(n-1)(n-2)\dots(n-r+1) = \frac{n!}{(n-r)!} $$
    *   *解释*：
        *   第 1 个位置有 $n$ 种选择；
        *   第 2 个位置剩 $n-1$ 种选择；
        *   ……
        *   第 $r$ 个位置剩 $n-r+1$ 种选择。
    *   **规定**：$0! = 1$。
    *   **全排列**：$P(n, n) = n!$。

#### 2. 集合的组合 (Combination of Sets) —— 无重复，无序

这是另一个经典模型：从一堆**不同**的东西里，选出几个来**组成一组**（不排队）。

*   **组合**：
    从 $S$ 中**无序**选取的 $r$ 个元素称为 $S$ 的一个 $r$ 组合。
    *   *本质*：$S$ 的一个 $r$ 组合就是 $S$ 的一个基数为 $r$ 的**子集**。
*   **记号**：
    $S$ 的不同 $r$ 组合总数记作 $C(n, r)$，或者更通用的二项式系数符号 $\binom{n}{r}$。
*   **组合数公式**：
    $$ C(n, r) = \binom{n}{r} = \frac{P(n, r)}{r!} = \frac{n!}{r!(n-r)!} $$
    *   *解释*：
        先按有序选出 $r$ 个元素（$P(n, r)$ 种），但因为我们不在乎顺序，所以要把这 $r$ 个元素内部的排列数（$r!$ 种）除掉。
*   **重要性质**：
    1.  **对称性**：$C(n, r) = C(n, n-r)$。
        *   *解释*：选 $r$ 个带走，等于选 $n-r$ 个留下。
    2.  **杨辉三角递推式**：$C(n, r) = C(n-1, r-1) + C(n-1, r)$。
        *   *解释*：对于某个特定元素 $x$，选出的 $r$ 个里要么**包含** $x$（剩下需从 $n-1$ 里选 $r-1$），要么**不包含** $x$（需从 $n-1$ 里选 $r$）。

#### 3. 环排列 (Circular Permutation)

*   **定义**：
    $n$ 个不同元素围成一个**圆圈**的排列。
    *   *特点*：旋转后重合的排列视为同一种排列（没有固定的“起点”）。
*   **推论**：
    $n$ 个不同元素的环排列总数为：
    $$ \frac{P(n, n)}{n} = (n-1)! $$
    *   *解释*：线排列有 $n!$ 种，围成圈后，每 $n$ 种旋转状态对应同一个环排列，所以除以 $n$。
    *   *更通用的理解*：固定其中一个人坐下（作为参照物），剩下 $n-1$ 个人随便排。

#### 4. 多重集的排列 (Permutation of Multisets) —— 有重复，有序

如果不让选重复元素，但集合里本身就有重复元素（比如 "BOOK" 里有两个 'O'），怎么排？

*   **多重集定义**：
    设 $S = \{n_1 \cdot a_1, n_2 \cdot a_2, \dots, n_k \cdot a_k\}$ 为多重集。
    *   $a_1, \dots, a_k$ 是 $k$ 种不同的元素。
    *   $n_i$ 是元素 $a_i$ 的**重复度**（即有多少个 $a_i$）。
    *   $n = n_1 + \dots + n_k$ 是 $S$ 中元素的总数。
    *   $n_i = \infty$ 表示元素 $a_i$ 有无限多个（足够多）。
*   **有限多重集的全排列**：
    设 $S$ 的元素总数为 $n$，且每个元素的重复度有限。则 $S$ 的全排列数为：
    $$ \frac{n!}{n_1! n_2! \dots n_k!} $$
    *   *解释*：先假设所有元素都不同，有 $n!$ 种排法。然后因为 $n_1$ 个 $a_1$ 是相同的，它们内部交换位置看不出来，所以要除以 $n_1!$；同理除以 $n_2!, \dots, n_k!$。
    *   这个数也记作**多项式系数** $\binom{n}{n_1, n_2, \dots, n_k}$。
*   **推论 (无限多重集的 $r$ 排列)**：
    如果每种元素的重复度都是 $\infty$（或者至少 $\ge r$），那么从 $k$ 种元素中选取 $r$ 个进行排列的方法数为：
    $$ k^r $$
    *   *解释*：每个位置都有 $k$ 种选择，互不影响。

#### 5. 多重集的组合 (Combination of Multisets) —— 有重复，无序

这是最容易混淆的模型：允许重复选取元素，且不考虑顺序。

*   **定义**：
    从多重集 $S$ 中选取 $r$ 个元素作为**子多重集**。如果 $S$ 中每种元素的重复度都至少为 $r$（即 $\infty \cdot a_1, \dots, \infty \cdot a_k$），这被称为**允许重复的组合**。
*   **等价模型**：
    1.  从 $k$ 类不同物品中，取 $r$ 个物品（允许重复取）。
    2.  将 $r$ 个**相同**的小球，放入 $k$ 个**不同**的盒子中（允许有空盒）。
    3.  求不定方程 $x_1 + x_2 + \dots + x_k = r$ 的**非负整数解**的个数。
*   **隔板法**：
    从 $k$ 个不同元素中，允许重复地选取 $r$ 个元素的组合数是：
    $$ C(r+k-1, r) = C(r+k-1, k-1) $$
    *   *证明思路（隔板法）*：
        把 $r$ 个小球排成一排，在中间插入 $k-1$ 个“隔板”。
        隔板把球分成了 $k$ 部分，第 $i$ 部分的球数就是第 $i$ 类元素的选取数量。
        总位置数 = 球数 $r$ + 隔板数 $k-1$。
        我们需要从中选出 $k-1$ 个位置放隔板（或者选 $r$ 个位置放球）。
*   **注意**：
    这个公式要求**每种元素都足够多**（至少 $r$ 个）。如果某些元素的数量有限制（比如第1种元素最多只能取2个），则不能直接用此公式，通常需要用**生成函数**或**容斥原理**求解。

**总结：四个基本计数模型对比**

| 选取方式 | 元素来源 | 是否允许重复 | 是否考虑顺序 | 公式 |
| :--- | :--- | :--- | :--- | :--- |
| **集合的排列** | $n$ 个不同元素 | 否 | **是** | $P(n, r) = \frac{n!}{(n-r)!}$ |
| **集合的组合** | $n$ 个不同元素 | 否 | **否** | $C(n, r) = \frac{n!}{r!(n-r)!}$ |
| **多重集的排列** | $k$ 种元素(无限) | **是** | **是** | $k^r$ |
| **多重集的组合** | $k$ 种元素(无限) | **是** | **否** | $C(r+k-1, r)$ |

### 12.3 二项式定理与组合恒等式

#### 1. 二项式定理 (Binomial Theorem)

*   **二项式定理**：
    设 $n$ 是正整数，$x, y$ 为任意实数（或复数），则：
    $$ (x+y)^n = \sum_{k=0}^n \binom{n}{k} x^k y^{n-k} $$
*   **二项式系数**：
    展开式中 $x^k y^{n-k}$ 的系数 $\binom{n}{k}$（即 $C(n, k)$）称为**二项式系数**。
*   **组合意义**：
    在 $(x+y)(x+y)\dots(x+y)$ 的 $n$ 个括号中，每一项的乘积是通过从每个括号里选 $x$ 或选 $y$ 得到的。
    如果要得到 $x^k y^{n-k}$，必须恰好在 $k$ 个括号中选 $x$，在剩下的 $n-k$ 个括号中选 $y$。从 $n$ 个括号中选 $k$ 个选 $x$ 的方法数正是 $\binom{n}{k}$。

#### 2. 基本组合恒等式

基于二项式定理，通过对 $x, y$ 赋予特定的值，可以推导出许多重要的恒等式。

1.  **对称性**：
    $$ \binom{n}{k} = \binom{n}{n-k} $$
    *   *意义*：选 $k$ 个带走等于选 $n-k$ 个留下。
2.  **帕斯卡公式 (Pascal's Identity) / 递推性**：
    $$ \binom{n}{k} = \binom{n-1}{k} + \binom{n-1}{k-1} $$
    *   *意义*：组合数的递推关系，对应杨辉三角。
3.  **吸收/提取公式**：
    $$ \binom{n}{k} = \frac{n}{k} \binom{n-1}{k-1} \quad (k \ge 1) $$
    $$ k \binom{n}{k} = n \binom{n-1}{k-1} $$
    *   *作用*：常用于将组合数中的变量 $k$ 移到外面，或者降低组合数的阶数。
4.  **系数之和**：
    令 $x=1, y=1$，代入二项式定理：
    $$ \sum_{k=0}^n \binom{n}{k} = 2^n $$
    *   *意义*：$n$ 元集的所有子集个数为 $2^n$。
5.  **交错和**：
    令 $x=-1, y=1$，代入二项式定理：
    $$ \sum_{k=0}^n (-1)^k \binom{n}{k} = 0 $$
    *   *意义*：奇数个元素的子集个数等于偶数个元素的子集个数（即 $\sum \binom{n}{2k} = \sum \binom{n}{2k+1} = 2^{n-1}$）。

#### 3. 范德蒙德恒等式及其推广

这类恒等式涉及两个或多个集合的组合计数，通常采用**组合分析法**（算两次）证明。

*   **积的组合恒等式 (Subset of a Subset)**：
    $$ \binom{n}{k} \binom{k}{r} = \binom{n}{r} \binom{n-r}{k-r} $$
    *   *组合意义*：
        *   左边：先从 $n$ 人中选 $k$ 人组成“代表团”，再从 $k$ 人中选 $r$ 人当“核心成员”。
        *   右边：先从 $n$ 人中直接选 $r$ 人当“核心成员”，再从剩下 $n-r$ 人中选 $k-r$ 人补充进“代表团”。
*   **范德蒙德恒等式 (Vandermonde's Identity)**：
    $$ \sum_{k=0}^r \binom{m}{k} \binom{n}{r-k} = \binom{m+n}{r} $$
    *   *条件*：$r \le \min(m, n)$。
    *   *组合意义*：
        设甲组有 $m$ 人，乙组有 $n$ 人，共 $m+n$ 人。从中选出 $r$ 人的方法数 $\binom{m+n}{r}$。
        这等价于：枚举从甲组选 $k$ 人，从乙组选 $r-k$ 人，并将所有可能的 $k$ 值（$0$ 到 $r$）的情况相加。
*   **平方和恒等式**：
    这是范德蒙德恒等式的特例（令 $m=n, r=n$，并利用对称性 $\binom{n}{n-k} = \binom{n}{k}$）：
    $$ \sum_{k=0}^n \binom{n}{k}^2 = \binom{2n}{n} $$

#### 4. 涉及导数的恒等式

利用微积分方法处理二项式定理，可以求出带系数 $k$ 的组合数和。

*   **一阶矩**：
    $$ \sum_{k=0}^n k \binom{n}{k} = n 2^{n-1} $$
    *   *证明思路*：对 $(1+x)^n = \sum \binom{n}{k} x^k$ 两边求导，得 $n(1+x)^{n-1} = \sum k \binom{n}{k} x^{k-1}$，再令 $x=1$。
*   **二阶矩**：
    $$ \sum_{k=0}^n k^2 \binom{n}{k} = n(n+1) 2^{n-2} $$
    *   *证明思路*：再次求导或利用 $k^2 = k(k-1) + k$ 拆分求解。

#### 5. 多项式定理 (Multinomial Theorem)

这是二项式定理在多项展开上的推广。

*   **多项式定理**：
    设 $n$ 为正整数，则 $(x_1 + x_2 + \dots + x_t)^n$ 的展开式为：
    $$ \sum \frac{n!}{n_1! n_2! \dots n_t!} x_1^{n_1} x_2^{n_2} \dots x_t^{n_t} $$
    *   **求和条件**：对所有满足 $n_1 + n_2 + \dots + n_t = n$ 的非负整数解组 $(n_1, \dots, n_t)$ 求和。
*   **多项式系数**：
    系数 $\frac{n!}{n_1! n_2! \dots n_t!}$ 记作 $\binom{n}{n_1 n_2 \dots n_t}$，称为**多项式系数**。
    *   它恰好等于多重集 $\{ n_1 \cdot x_1, \dots, n_t \cdot x_t \}$ 的全排列数。
*   **项数**：
    展开式中不同项的个数等于方程 $n_1 + \dots + n_t = n$ 的非负整数解的个数，即 $\binom{n+t-1}{n}$（隔板法）。

### 12.4 非降路径问题 (Catalan Number 相关)

#### 1. 格路计数
*   **问题**：在二维网格中，从 $(0,0)$ 走到 $(m, n)$，每步只能向右 ($x+1$) 或向上 ($y+1$)，共有多少种路径？
*   **解法**：总共需要走 $m+n$ 步，其中必须有 $m$ 步向右，$n$ 步向上。
*   **公式**：
    $$ \binom{m+n}{m} = \binom{m+n}{n} $$

#### 2. 卡特兰数 (Catalan Number)
*   **问题**：从 $(0,0)$ 到 $(n,n)$ 的路径中，**不越过对角线** $y=x$（即始终满足 $y \le x$ 或始终 $y \ge x$）的路径数。
*   **公式**：
    $$ C_n = \frac{1}{n+1} \binom{2n}{n} $$
*   **应用**：
    *   $n$ 对括号的合法匹配数。
    *   凸 $n+2$ 边形的三角剖分数。
    *   $n$ 个节点的二叉树形态数。
    *   进出栈序列数。

## 第13章 递推方程与生成函数

### 13.1 递推方程的定义及实例

#### 1. 递推方程 (Recurrence Relation)
*   **定义**：设序列 $a_0, a_1, \dots, a_n, \dots$。一个把 $a_n$ 与某些个 $a_i (i < n)$ 联系起来的等式，称为关于序列 $\{a_n\}$ 的递推方程。
*   **初值**：为了确定唯一的序列，通常需要给定前几项的值，称为初值（或边界条件）。

#### 2. 经典实例
*   **Hanoi 塔问题**：
    *   设 $T(n)$ 为移动 $n$ 个圆盘所需的最小步数。
    *   递推方程：$T(n) = 2T(n-1) + 1$。
    *   初值：$T(1) = 1$。
    *   解：$T(n) = 2^n - 1$。
*   **Fibonacci 数列**：
    *   问题背景：兔子繁殖问题（如果不死且每月生一对）。
    *   递推方程：$f_n = f_{n-1} + f_{n-2}$ ($n \ge 2$)。
    *   初值：$f_0 = 1, f_1 = 1$ （注：不同教材初值可能略有不同，如从 $f_1, f_2$ 开始）。
    *   通项公式（Binet 公式）：
        $$ f_n = \frac{1}{\sqrt{5}} \left[ \left( \frac{1+\sqrt{5}}{2} \right)^{n+1} - \left( \frac{1-\sqrt{5}}{2} \right)^{n+1} \right] $$

### 13.2 递推方程的公式解法

本节主要讨论**常系数线性递推方程**的解法。

#### 1. 基本概念
*   **$k$ 阶常系数线性递推方程**：
    $$ H(n) - a_1 H(n-1) - a_2 H(n-2) - \dots - a_k H(n-k) = f(n) $$
    其中 $a_1, \dots, a_k$ 为常数且 $a_k \neq 0$。
*   **齐次与非齐次**：
    *   若 $f(n) = 0$，称为**齐次**递推方程。
    *   若 $f(n) \neq 0$，称为**非齐次**递推方程。

#### 2. 常系数线性**齐次**递推方程的求解
**步骤**：
1.  **写出特征方程**：
    将 $H(n-i)$ 替换为 $x^{k-i}$，得到：
    $$ x^k - a_1 x^{k-1} - a_2 x^{k-2} - \dots - a_k = 0 $$
    求出该方程的 $k$ 个根 $q_1, q_2, \dots, q_k$（称为特征根）。

2.  **写出通解结构**：
    *   **情况1：特征根互不相同**（$k$ 个单根）。
        $$ H(n) = c_1 q_1^n + c_2 q_2^n + \dots + c_k q_k^n $$
    *   **情况2：有重根**。
        若 $q_1$ 是 $m$ 重根，则它对应的通解部分为：
        $$ (c_1 + c_2 n + c_3 n^2 + \dots + c_m n^{m-1}) q_1^n $$
        即系数变为关于 $n$ 的 $m-1$ 次多项式。

3.  **确定待定常数**：
    利用给定的 $k$ 个初值 $H(0), \dots, H(k-1)$，列出线性方程组，解出 $c_1, \dots, c_k$。

#### 3. 常系数线性**非齐次**递推方程的求解
**通解结构**：
$$ H(n) = H^*(n) + \bar{H}(n) $$
其中：
*   $\bar{H}(n)$ 是对应**齐次**方程的通解（按上述方法求）。
*   $H^*(n)$ 是原非齐次方程的一个**特解**。

**特解 $H^*(n)$ 的求法**（待定系数法）：
取决于非齐次项 $f(n)$ 的形式。
*   **形式1**：$f(n) = P_m(n) \beta^n$，其中 $P_m(n)$ 是 $n$ 的 $m$ 次多项式，$\beta$ 是常数。
    *   设特解 $H^*(n) = n^s Q_m(n) \beta^n$。
    *   其中 $Q_m(n)$ 是待定的 $m$ 次多项式。
    *   **$s$ 的取值**：
        *   若 $\beta$ **不是**特征方程的根，则 $s=0$。
        *   若 $\beta$ 是特征方程的 $t$ 重根，则 $s=t$。
*   **形式2**：$f(n) = \beta^n [ P_m(n) \cos(n\theta) + Q_m(n) \sin(n\theta) ]$。
    *   通常涉及复数特征根，处理较复杂，需设特解包含 $\sin$ 和 $\cos$ 项。

### 13.3 递推方程的其他解法

#### 1. 换元法
通过变量代换将非线性或复杂形式转化为线性常系数方程。
*   **例**：$T(n) = 2T(n/2) + n$ （分治算法常用）。
    *   令 $n = 2^k, a_k = T(2^k)$，化为 $a_k = 2a_{k-1} + 2^k$。
    *   解得 $a_k = (k+1)2^k \Rightarrow T(n) = n \log_2 n + n$。

#### 2. 迭代归纳法
*   不断展开递推式，直到初值，发现规律，再用数学归纳法证明。
*   **例**：$H(n) = 2H(n-1) + 1 \Rightarrow H(n) = 2^n - 1$。

#### 3. 差消法
*   适用于含有求和符号的递推式。
*   **方法**：写出 $D_n$ 和 $D_{n-1}$ 的表达式，两式相减消去求和项，转化为标准递推方程。
*   **例**：错排问题 $D_n = (n-1)(D_{n-1} + D_{n-2})$。

### 13.4 生成函数及其应用

生成函数（Generating Function），也称为母函数，是处理数列和组合计数问题的有力工具。

#### 1. 生成函数的定义

*   **定义**：
    设序列 $a_0, a_1, \dots, a_n, \dots$ 是一个无穷数列（通常简记为 $\{a_n\}$）。
    称幂级数
    $$ G(x) = \sum_{n=0}^{\infty} a_n x^n = a_0 + a_1 x + a_2 x^2 + \dots + a_n x^n + \dots $$
    为序列 $\{a_n\}$ 的**生成函数**。
*   **理解**：
    *   $x$ 只是一个形式变量（标记符号），我们不关心它取什么值，也不关心级数是否收敛。
    *   我们只关心 $x^n$ 前面的系数 $a_n$。生成函数就像一个挂钩，$x^n$ 是挂钩，把 $a_n$ 挂在上面展示出来。
*   **例子**：
    *   序列 $1, 1, 1, \dots$ 的生成函数是 $G(x) = 1 + x + x^2 + \dots = \frac{1}{1-x}$。
    *   序列 $1, 2, 3, \dots$ 的生成函数是 $G(x) = 1 + 2x + 3x^2 + \dots = \frac{1}{(1-x)^2}$。
    *   有限序列（如二项式系数 $\binom{n}{0}, \binom{n}{1}, \dots, \binom{n}{n}$）的生成函数是多项式 $(1+x)^n$。

#### 2. 牛顿二项式定理与广义二项式系数

这是展开生成函数的核心工具。

*   **广义组合数**：
    设 $r$ 为任意实数，$n$ 为整数。
    $$ \binom{r}{n} = \begin{cases} 0, & n < 0 \\ 1, & n = 0 \\ \frac{r(r-1)\dots(r-n+1)}{n!}, & n > 0 \end{cases} $$
    *   注意：当 $r$ 不是正整数时，$\binom{r}{n}$ 不会截断，一直有值。
*   **牛顿二项式定理**：
    设 $\alpha$ 为实数，则对一切实数 $x, y$ 满足 $|x/y| < 1$：
    $$ (x+y)^\alpha = \sum_{n=0}^{\infty} \binom{\alpha}{n} x^n y^{\alpha-n} $$
*   **重要特例**：
    1.  **负指数幂（几何级数推广）**：
        $$ \frac{1}{(1-x)^m} = (1-x)^{-m} = \sum_{n=0}^{\infty} \binom{-m}{n} (-x)^n = \sum_{n=0}^{\infty} \binom{n+m-1}{n} x^n $$
        *   系数 $\binom{n+m-1}{n}$ 正好是**多重集组合数**（$n$ 个相同球放入 $m$ 个不同盒子）。
    2.  **基本几何级数**：
        $$ \frac{1}{1-x} = \sum_{n=0}^{\infty} x^n $$
    3.  **指数函数**：
    $$ e^x = \sum_{n=0}^{\infty} \frac{x^n}{n!} $$

#### 3. 利用生成函数求解递推方程

这是生成函数最经典的代数应用。

*   **基本步骤**：
    1.  **设函数**：设序列 $\{a_n\}$ 的生成函数为 $G(x) = \sum_{n=0}^{\infty} a_n x^n$。
    2.  **乘 $x$ 求和**：在递推方程（如 $a_n - 2a_{n-1} = 0$）两端同乘 $x^n$，并对所有有效的 $n$ 求和。
    3.  **化简**：利用 $\sum a_{n-k} x^n = x^k G(x)$ 等性质，将方程转化为关于 $G(x)$ 的代数方程。
    4.  **解函数**：解出 $G(x)$ 的显式表达式（通常是有理分式 $\frac{P(x)}{Q(x)}$）。
    5.  **展开**：将 $G(x)$ 展开成幂级数（利用部分分式分解），其系数即为通项公式 $a_n$。
*   **例题思路（斐波那契数列）**：
    *   方程 $a_{n+2} = a_{n+1} + a_n$。
    *   转化为 $G(x)$ 的关系：$\frac{G(x) - a_0 - a_1 x}{x^2} = \frac{G(x) - a_0}{x} + G(x)$。
    *   解得 $G(x) = \frac{x}{1-x-x^2}$。
    *   部分分式分解后展开，得到通项公式。

#### 4. 利用生成函数解决组合计数问题

这是生成函数最直观的组合应用。

*   **模型**：
    若要从 $k$ 种物品中选取 $n$ 个，且第 $i$ 种物品选取的数量限制为集合 $S_i$（例如 $S_1=\{0, 1\}$ 表示第1种只能选0或1个）。
    则该问题的生成函数为：
    $$ G(x) = \left( \sum_{j \in S_1} x^j \right) \left( \sum_{j \in S_2} x^j \right) \dots \left( \sum_{j \in S_k} x^j \right) $$
    展开式中 **$x^n$ 的系数** 即为选取 $n$ 个物品的总方案数。
*   **典型例子**：
    *   **多重集组合**：每种物品有无限个（$S_i = \mathbb{N}$）。
        因子为 $(1+x+x^2+\dots) = \frac{1}{1-x}$。$k$ 种物品即 $\frac{1}{(1-x)^k}$，展开系数为 $\binom{n+k-1}{n}$。
    *   **找零钱问题**：1分、2分、5分硬币凑 $n$ 分。
        $G(x) = \frac{1}{1-x} \cdot \frac{1}{1-x^2} \cdot \frac{1}{1-x^5}$。
    *   **整数拆分**：将 $n$ 拆分为若干正整数之和。
        $G(x) = \prod_{k=1}^{\infty} \frac{1}{1-x^k}$。

### 13.5 指数生成函数及其应用

普通生成函数用于解决**组合（无序）**问题，而指数生成函数专门用于解决**排列（有序）**问题。

#### 1. 指数生成函数的定义

*   **定义 13.7**：
    设序列 $\{a_n\}$。称级数
    $$ G_e(x) = \sum_{n=0}^{\infty} a_n \frac{x^n}{n!} = a_0 + a_1 \frac{x}{1!} + a_2 \frac{x^2}{2!} + \dots $$
    为序列 $\{a_n\}$ 的**指数生成函数**。
*   **区别**：普通生成函数系数是 $a_n$，指数生成函数系数是 $\frac{a_n}{n!}$。
*   **为什么要除以 $n!$？**
    因为在排列问题中，当你合并两个独立的排列任务（比如先排 $m$ 个，再排 $n$ 个）时，总数不仅是乘积，还需要乘以一个二项式系数 $\binom{m+n}{m}$ 来表示这两组元素相互穿插的位置选择。指数生成函数的乘法卷积恰好自动处理了这个二项式系数：
    $$ \frac{x^m}{m!} \cdot \frac{x^n}{n!} = \frac{x^{m+n}}{m!n!} = \frac{(m+n)!}{m!n!} \frac{x^{m+n}}{(m+n)!} = \binom{m+n}{m} \frac{x^{m+n}}{(m+n)!} $$

#### 2. 多重集的排列计数

这是指数生成函数最主要的应用场景。

*   **模型**：
    设有 $k$ 种元素，要构造长度为 $n$ 的排列。其中第 $i$ 种元素出现的次数必须在集合 $S_i$ 中。
    求满足条件的排列总数 $a_n$。
*   **方法**：
    1.  为每种元素构造一个“指数级数因子”：
        $$ f_i(x) = \sum_{j \in S_i} \frac{x^j}{j!} $$
    2.  将所有因子相乘得到总的指数生成函数：
        $$ G_e(x) = f_1(x) f_2(x) \dots f_k(x) $$
    3.  将 $G_e(x)$ 展开为幂级数：
        $$ G_e(x) = \sum_{n=0}^{\infty} b_n \frac{x^n}{n!} $$
    4.  **$x^n/n!$ 的系数 $b_n$** 即为所求的排列数 $a_n$。
*   **例子**：
    由 A, B, C 组成 $n$ 位字符串，要求 A 出现偶数次。
    *   A 的因子：$1 + \frac{x^2}{2!} + \frac{x^4}{4!} + \dots = \frac{e^x + e^{-x}}{2}$ （双曲余弦）。
    *   B 的因子：$1 + \frac{x}{1!} + \frac{x^2}{2!} + \dots = e^x$。
    *   C 的因子：$e^x$。
    *   总函数：$G_e(x) = \frac{e^x + e^{-x}}{2} \cdot e^x \cdot e^x = \frac{e^{3x} + e^x}{2}$。
    *   展开求 $x^n/n!$ 系数：$a_n = \frac{3^n + 1}{2}$。

#### 3. 错排问题 (Derangement)

指数生成函数可以优雅地推导错排公式。

*   **问题**：$n$ 个元素排列，没有任何元素在自己原来的位置上（$p_i \neq i$）。
*   **推导**：
    *   所有排列数 $n!$ 对应生成函数 $\sum n! \frac{x^n}{n!} = \sum x^n = \frac{1}{1-x}$。
    *   性质 $p_i = i$ 对应因子 $e^x$（这是基于容斥原理或不动点统计的高级推导，此处略去细节）。
    *   最终错排数的指数生成函数为：
        $$ D(x) = \frac{e^{-x}}{1-x} $$
    *   展开得通项：$D_n = n! \sum_{k=0}^{n} \frac{(-1)^k}{k!}$。


### 13.6 Catalan 数与 Stirling 数

#### 1. Catalan 数 (卡特兰数)
*   **递推定义**：$h_n = \sum_{k=1}^{n-1} h_k h_{n-k}$，初值 $h_1=1$（注意：不同定义下标可能差1，有的从 $h_0=1$ 开始）。
*   **通项公式**：
    $$ C_n = \frac{1}{n+1} \binom{2n}{n} $$
*   **应用场景**：
    *   凸多边形三角剖分。
    *   括号匹配。
    *   二叉树计数。
    *   出栈序列。

#### 2. Stirling 数 (斯特林数)
**(1) 第二类 Stirling 数 $S(n, m)$**
*   **定义**：将 $n$ 个**不同**元素划分成 $m$ 个**非空**子集（集合无序，元素不同）的方法数。
    *   相当于：$n$ 个不同球放入 $m$ 个相同盒子，无空盒。
*   **记号**：$S(n, m)$ 或 $\left\{ \begin{smallmatrix} n \\ m \end{smallmatrix} \right\}$。
*   **递推公式**：
    $$ S(n, m) = S(n-1, m-1) + m \cdot S(n-1, m) $$
    *   *解释*：对于第 $n$ 个元素，要么它自己单独一组（$S(n-1, m-1)$），要么放入已有的 $m$ 个组中的某一个（$m \cdot S(n-1, m)$）。
*   **性质**：
    *   $S(n, 1) = 1, S(n, n) = 1$。
    *   $x^n = \sum_{k=0}^n S(n, k) [x]_k$，其中 $[x]_k = x(x-1)\dots(x-k+1)$ 是下降阶乘幂。

**(2) 第一类 Stirling 数 $s(n, m)$**
*   **定义**：将 $n$ 个不同元素排成 $m$ 个非空轮换（Cycle）的方法数。
*   **记号**：$s(n, m)$ 或 $\left[ \begin{smallmatrix} n \\ m \end{smallmatrix} \right]$。
*   **递推公式**：
    $$ s(n, m) = s(n-1, m-1) + (n-1)s(n-1, m) $$
    *   *解释*：第 $n$ 个元素要么自成一环，要么插入到前 $n-1$ 个元素组成的 $m$ 个环中的任意一个元素的左边（共 $n-1$ 个位置）。

